{{!< default}}

{{#post}}
<style>
    /* Hero background for a premium feel */
    .post-hero-video {
        background-color: #2c3e50;
        background-image: linear-gradient(rgba(10, 10, 10, 0.85), rgba(10, 10, 10, 0.85)),
                          url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
    }

    /* Styles for the mobile timestamp accordion */
    #timestamps-widget-mobile .panel-content { display: none; border-top: 1px solid #dbdbdb; }
    #timestamps-widget-mobile.is-active .panel-content { display: block; }
    #timestamps-widget-mobile.is-active .panel-heading .icon.is-angle { transform: rotate(180deg); }

    /* Responsive visibility for desktop vs mobile timestamps */
    @media (min-width: 1024px) { /* Bulma's 'desktop' breakpoint */
        #timestamps-widget-mobile { display: none !important; }
    }
    @media (max-width: 1023px) {
        #timestamps-widget-desktop { display: none !important; }
    }

    /* Styles for the share buttons */
    .share-buttons a {
        transition: transform 0.2s ease-out;
    }
    .share-buttons a:hover {
        transform: translateY(-3px);
    }
</style>

{{!-- Cinematic Hero Section with Rich Meta Details --}}
<section class="hero is-dark post-hero-video">
  <div class="hero-body">
    <div class="container">
      <div class="mb-4">
        {{#if tags}}
          <div class="tags">
            {{#foreach tags}}
              <a class="tag is-primary is-light" href="{{url}}">{{name}}</a>
            {{/foreach}}
          </div>
        {{/if}}
      </div>
      <h1 class="title is-size-1-desktop is-size-2-tablet is-size-3-mobile has-text-weight-bold post-title">
        {{title}}
      </h1>
      <div class="is-size-6 has-text-grey-light mt-4">
        By <a href="{{primary_author.url}}" class="has-text-white has-text-weight-semibold">{{primary_author.name}}</a> •
        <time datetime="{{date format="YYYY-MM-DD"}}">{{date format="MMMM DD, YYYY"}}</time> •
        <span>{{reading_time}}</span>
      </div>
    </div>
  </div>
</section>

<main class="section">
  <div class="container">
    <div class="columns is-variable is-8-desktop">

      {{!-- ======== Main Content Column (Wider) ======== --}}
      <div class="column is-9">
        <div class="box p-4 p-5-tablet">
          {{!-- The YouTube iframe player --}}
          <figure class="image is-16by9 mb-6" style="border-radius: 8px; overflow: hidden;">
            <iframe id="youtube-player" class="has-ratio" src="https://www.youtube.com/embed/{{custom_excerpt}}?rel=0&enablejsapi=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </figure>
          
          {{!-- Mobile Timestamp Accordion (hidden on desktop) --}}
          <div id="timestamps-widget-mobile" class="panel is-link mb-6">
            <p class="panel-heading is-clickable">
              <span class="icon-text"><span class="icon"><i class="fas fa-list-ol"></i></span><span>Video Timestamps</span></span>
              <span class="icon is-angle"><i class="fas fa-angle-down"></i></span>
            </p>
            <div class="panel-content" id="timestamps-target-mobile"></div>
          </div>
          
          {{!-- In-Article AdSense Placeholder --}}
          <div class="box has-background-light has-text-centered my-6">
            <p class="has-text-grey">AdSense Unit (e.g., In-article ad)</p>
          </div>

          {{!-- Main post content --}}
          <div class="content post-content-body is-medium gh-content">
            {{content}}
          </div>
          
          <hr>
          
          {{!-- Share Buttons --}}
          <div class="share-buttons has-text-centered my-6">
            <p class="title is-5 mb-4">Share this video</p>
            <div class="buttons is-centered">
              <a class="button is-large is-twitter" data-social="twitter"><span class="icon"><i class="fab fa-twitter"></i></span></a>
              <a class="button is-large is-facebook" data-social="facebook"><span class="icon"><i class="fab fa-facebook-f"></i></span></a>
              <a class="button is-large is-linkedin" data-social="linkedin"><span class="icon"><i class="fab fa-linkedin-in"></i></span></a>
              <a class="button is-large is-whatsapp" data-social="whatsapp"><span class="icon"><i class="fab fa-whatsapp"></i></span></a>
            </div>
          </div>
          
          {{!-- Author Bio Box --}}
          {{#primary_author}}
            <div class="box has-background-light">
              <article class="media">
                {{#if profile_image}}
                  <figure class="media-left">
                    <p class="image is-96x96">
                      <img class="is-rounded" src="{{profile_image}}" alt="{{name}}">
                    </p>
                  </figure>
                {{/if}}
                <div class="media-content">
                  <div class="content">
                    <p class="title is-4">{{name}}</p>
                    <p class="subtitle is-6">{{location}}</p>
                    <p>{{bio}}</p>
                    <a href="{{url}}" class="button is-link is-outlined is-small">More posts by this author</a>
                  </div>
                </div>
              </article>
            </div>
          {{/primary_author}}

          {{!-- Ghost Portal Comments --}}
          <div class="mt-6">{{comments}}</div>
        </div>
      </div>

      {{!-- ======== Sidebar Column (Narrower) ======== --}}
      <div class="column is-3">
        <aside class="post-sidebar-sticky">
        
          {{!-- Desktop Timestamps (hidden on mobile) --}}
          <div id="timestamps-widget-desktop" class="panel is-link mb-5" style="display: none;">
            <p class="panel-heading">Timestamps</p>
            <div id="timestamps-target-desktop"></div>
          </div>

          {{!-- Sidebar AdSense Placeholder --}}
          <div class="box has-background-light has-text-centered mb-5">
            <p class="has-text-grey">AdSense Unit (e.g., Display ad)</p>
          </div>

          {{!-- Related Videos --}}
          {{#get "posts" filter="tags:hash-video+id:-{{id}}" limit="3" as |related|}}
            {{#if related}}
            <div class="box">
              <h3 class="title is-5 mb-4">Related Videos</h3>
                {{#foreach related}}
                  <a href="{{url}}" class="is-block mb-4">
                    <figure class="image is-16by9 mb-2">
                      {{#if feature_image}}
                        <img src="{{feature_image}}" alt="{{title}}" loading="lazy" style="border-radius: 6px;">
                      {{else}}
                        <img src="https://i.ytimg.com/vi/{{custom_excerpt}}/hqdefault.jpg" alt="{{title}}" loading="lazy" style="border-radius: 6px;">
                      {{/if}}
                    </figure>
                    <p class="is-size-6 has-text-weight-semibold has-text-dark" style="line-height: 1.3;">{{title}}</p>
                  </a>
                {{/foreach}}
            </div>
            {{/if}}
          {{/get}}
        </aside>
      </div>
    </div>
  </div>
</main>


{{!-- ================== JAVASCRIPT & SEO ================== --}}
<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player; // Make player globally accessible
    
    // This function is called by the YouTube API script
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player', {
            events: { 'onReady': onPlayerReady }
        });
    }

    // Function to set up timestamp click listeners once player is ready
    function onPlayerReady(event) {
        document.querySelectorAll('a.timestamp-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const time = parseFloat(link.dataset.time);
                if (player && typeof player.seekTo === 'function') {
                    player.seekTo(time, true);
                    player.playVideo();
                }
            });
        });
    }
    
    // Main script execution on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        // ---- 1. Sticky Sidebar ----
        const sidebar = document.querySelector('.post-sidebar-sticky');
        if (sidebar && window.innerWidth >= 1024) {
            sidebar.style.position = 'sticky';
            sidebar.style.top = '2rem';
        }

        // ---- 2. Dynamic Timestamps (robust logic) ----
        const generateTimestamps = () => {
            const sourceTable = document.querySelector('.gh-content table');
            const desktopWidget = document.getElementById('timestamps-widget-desktop');
            const mobileWidget = document.getElementById('timestamps-widget-mobile');
            if (!sourceTable || !desktopWidget || !mobileWidget) return;

            const desktopTarget = document.getElementById('timestamps-target-desktop');
            const mobileTarget = document.getElementById('timestamps-target-mobile');
            const rows = sourceTable.querySelectorAll('tbody tr');
            
            if (rows.length === 0) return;
            
            const fragment = document.createDocumentFragment();
            rows.forEach(row => {
                const cells = row.querySelectorAll('td, th');
                if (cells.length < 2) return;

                const timeStr = cells[0].textContent.trim().split(' ')[0];
                const parts = timeStr.split(':').map(part => parseInt(part, 10));
                let seconds = 0;
                if (parts.length === 3) seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
                else if (parts.length === 2) seconds = parts[0] * 60 + parts[1];
                
                const link = document.createElement('a');
                link.className = 'panel-block is-flex is-justify-content-space-between timestamp-link';
                link.href = `#t=${seconds}`;
                link.dataset.time = seconds;
                link.innerHTML = `<span>${cells[0].textContent.trim()}</span><span class="has-text-right is-size-7">${cells[1].textContent.trim()}</span>`;
                fragment.appendChild(link);
            });
            
            desktopTarget.appendChild(fragment.cloneNode(true));
            mobileTarget.appendChild(fragment);
            
            desktopWidget.style.display = 'block';
            sourceTable.style.display = 'none';

            mobileWidget.querySelector('.panel-heading').addEventListener('click', () => {
                mobileWidget.classList.toggle('is-active');
            });
        };
        
        // ---- 3. Share Buttons ----
        const setupShareButtons = () => {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(document.title);
            document.querySelectorAll('.share-buttons a').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    let shareUrl = '';
                    const social = button.dataset.social;
                    if(social === 'twitter') shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                    if(social === 'facebook') shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                    if(social === 'linkedin') shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${title}`;
                    if(social === 'whatsapp') shareUrl = `https://api.whatsapp.com/send?text=${title}%20${url}`;
                    window.open(shareUrl, 'share-window', 'height=450,width=550,toolbar=0,location=0,menubar=0,directories=0,scrollbars=0');
                });
            });
        };
        
        generateTimestamps();
        setupShareButtons();
    });
</script>

{{!-- SEO: Dynamic JSON-LD VideoObject Schema --}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": "{{title}}",
  "description": "{{excerpt}}",
  "uploadDate": "{{date format="YYYY-MM-DDTHH:mm:ss.SSSZ"}}",
  "duration": "PT0M0S", {{!-- Placeholder: Manually update or use API for duration --}}
  "embedUrl": "https://www.youtube.com/embed/{{custom_excerpt}}",
  "thumbnailUrl": [
    {{#if feature_image}}
      "{{feature_image}}"
    {{else}}
      "https://i.ytimg.com/vi/{{custom_excerpt}}/maxresdefault.jpg",
      "https://i.ytimg.com/vi/{{custom_excerpt}}/hqdefault.jpg"
    {{/if}}
  ],
  "author": {
    "@type": "Person",
    "name": "{{primary_author.name}}"
  }
}
</script>
{{/post}}