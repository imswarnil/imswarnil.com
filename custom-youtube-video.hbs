{{!< default}}

{{!-- This template assumes you have a default.hbs that includes:
    - <head> with Font Awesome and a modern viewport.
    - <body> tag opening.
    - Bulma CSS link.
--}}

{{!-- Google Font for superior readability --}}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
    /* 
    This is the ONLY custom CSS, focused on enhancing Bulma's defaults for a premium feel.
    It doesn't create new components, only refines existing ones.
    */
    .post-body, .button, .input, .textarea, .title, .subtitle {
        font-family: 'Inter', sans-serif;
    }
    html {
        font-size: 17px;
        background-color: #f7f7fa; /* A soft, modern background */
    }
    @media screen and (max-width: 768px) {
        html { font-size: 16px; }
    }

    /* Style for the responsive, mobile-first timestamp accordion */
    #timestamps-accordion {
        display: none; /* Hidden on desktop */
    }
    #timestamps-accordion .panel-content {
        display: none;
        border-top: 1px solid #dbdbdb;
    }
    #timestamps-accordion.is-active .panel-content {
        display: block;
    }
    #timestamps-accordion.is-active .panel-heading .icon.is-angle {
        transform: rotate(180deg);
    }
    @media screen and (max-width: 1023px) {
        #timestamps-accordion { display: block; }
        #timestamps-sidebar { display: none !important; }
    }

    /* JavaScript-controlled behavior (not static styling) */
    .post-sidebar-sticky { position: static; }
    .is-sticky { position: sticky; top: 2rem; }
    .gh-content table { display: none; } /* Always hide the source table */
</style>

{{#post}}
<main class="section post-body">
  <div class="container">
    <div class="columns is-variable is-8-desktop">

      {{!-- ======== Main Content Column ======== --}}
      <div class="column is-8">
        
        {{!-- The YouTube Video Player --}}
        <figure class="image is-16by9 has-background-black" style="border-radius: 12px; overflow: hidden; box-shadow: 0 1rem 3rem -1rem rgba(0,0,0,0.2);">
            <iframe id="youtube-player" class="has-ratio" src="https://www.youtube.com/embed/{{custom_excerpt}}?rel=0&enablejsapi=1&color=white" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </figure>

        {{!-- Title, Meta, and Channel Info Block --}}
        <div class="box mt-6">
            <div class="p-4">
                {{#if tags}}
                    <div class="tags mb-4">
                        {{#foreach tags limit="3"}}<a class="tag is-primary is-light" href="{{url}}">{{name}}</a>{{/foreach}}
                    </div>
                {{/if}}
                <h1 class="title is-size-2-desktop is-size-3-mobile has-text-weight-bold post-title mb-4">{{title}}</h1>
                <hr class="my-5">
                {{!-- Channel & Subscribe Widget --}}
                <div class="level is-mobile">
                    <div class="level-left">
                        <a href="{{primary_author.url}}" class="media is-align-items-center">
                            <figure class="media-left"><p class="image is-48x48"><img class="is-rounded" src="{{primary_author.profile_image}}" alt="{{primary_author.name}}"></p></figure>
                            <div class="media-content">
                                <p class="title is-6">{{primary_author.name}}</p>
                                <p class="subtitle is-7 has-text-grey">{{excerpt}} subscribers</p>
                            </div>
                        </a>
                    </div>
                    <div class="level-right">
                        <a href="#" class="button is-danger is-rounded has-text-weight-bold">
                            <span class="icon"><i class="fab fa-youtube"></i></span>
                            <span class="is-hidden-mobile">Subscribe</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        {{!-- WIDGET: Mobile Timestamp Accordion (hidden on desktop) --}}
        <div id="timestamps-accordion" class="panel is-link my-6">
            <p class="panel-heading is-clickable">
                <span class="icon-text"><span class="icon"><i class="fas fa-list-ol"></i></span><span>Video Timestamps</span></span>
                <span class="icon is-angle"><i class="fas fa-angle-down"></i></span>
            </p>
            <div class="panel-content" id="timestamps-target-mobile"></div>
        </div>

        {{!-- Main Description Box --}}
        <div class="box p-6">
            <div class="content is-medium gh-content">
                {{content}}
            </div>
        </div>
        
      </div>

      {{!-- ======== Sidebar Column ======== --}}
      <div class="column is-4">
        <aside class="post-sidebar-sticky">
        
          {{!-- WIDGET 1: Timestamps for Desktop --}}
          <div id="timestamps-sidebar" class="panel is-link mb-6">
            <p class="panel-heading">Timestamps</p>
            <div id="timestamps-target-desktop" style="max-height: 45vh; overflow-y: auto;"></div>
          </div>

          {{!-- WIDGET 2: Related Videos --}}
          {{#get "posts" filter="tags:hash-video+id:-{{id}}" limit="3" as |related|}}
            {{#if related}}
            <div class="box p-5">
              <p class="title is-5 mb-5">Related Videos</p>
                {{#foreach related}}
                  <a href="{{url}}" class="is-block mb-5">
                    <figure class="image is-16by9 mb-3"><img class="is-rounded" src="{{#if feature_image}}{{feature_image}}{{else}}https://i.ytimg.com/vi/{{custom_excerpt}}/hqdefault.jpg{{/if}}" alt="{{title}}" loading="lazy"></figure>
                    <p class="is-size-6 has-text-weight-bold has-text-dark" style="line-height: 1.4;">{{title}}</p>
                  </a>
                {{/foreach}}
            </div>
            {{/if}}
          {{/get}}

        </aside>
      </div>
    </div>
  </div>
</main>


{{!-- ================== JAVASCRIPT & SEO ================== --}}
<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    let timestampDataForSeo = [];

    // This function is required by the YouTube API
    function onYouTubeIframeAPIReady() {
        if (document.getElementById('youtube-player')) {
            player = new YT.Player('youtube-player', { events: { 'onReady': onPlayerReady } });
        }
    }

    // This function runs once the player is ready, attaching click events.
    function onPlayerReady(event) {
        document.querySelectorAll('a.timestamp-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const time = parseFloat(link.dataset.time);
                if (player && typeof player.seekTo === 'function') {
                    player.seekTo(time, true);
                    player.playVideo();
                }
            });
        });
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        // ---- 1. Sticky Sidebar ----
        const sidebar = document.querySelector('.post-sidebar-sticky');
        if (sidebar && window.innerWidth >= 1024) {
            sidebar.classList.add('is-sticky');
        }

        // ---- 2. Dynamic Timestamps (for Desktop and Mobile) ----
        const generateTimestamps = () => {
            const sourceTable = document.querySelector('.gh-content table');
            const desktopWidget = document.getElementById('timestamps-sidebar');
            const mobileWidget = document.getElementById('timestamps-accordion');
            if (!sourceTable || !desktopWidget || !mobileWidget) return;

            const desktopTarget = document.getElementById('timestamps-target-desktop');
            const mobileTarget = document.getElementById('timestamps-target-mobile');
            const rows = sourceTable.querySelectorAll('tbody tr');
            if (rows.length === 0) return;
            
            const fragment = document.createDocumentFragment();
            rows.forEach(row => {
                const cells = row.querySelectorAll('td, th');
                if (cells.length < 2) return;
                
                const timeStr = cells[0].textContent.trim().split(' ')[0];
                const parts = timeStr.split(':').map(part => parseInt(part, 10));
                let seconds = 0;
                if (parts.length === 3) seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
                else if (parts.length === 2) seconds = parts[0] * 60 + parts[1];
                
                const link = document.createElement('a');
                link.className = 'panel-block is-flex is-justify-content-space-between timestamp-link';
                link.href = `#t=${seconds}`;
                link.dataset.time = seconds;
                link.innerHTML = `<span class="is-size-6">${cells[0].textContent.trim()}</span><span class="has-text-right is-size-7">${cells[1].textContent.trim()}</span>`;
                fragment.appendChild(link);

                timestampDataForSeo.push({"@type": "Clip", "name": cells[1].textContent.trim(), "startOffset": seconds, "url": window.location.href + `#t=${seconds}`});
            });
            
            desktopTarget.appendChild(fragment.cloneNode(true)); // Use a clone for desktop
            mobileTarget.appendChild(fragment); // Use the original for mobile
            
            // Toggle for mobile accordion
            mobileWidget.querySelector('.panel-heading').addEventListener('click', () => {
                mobileWidget.classList.toggle('is-active');
            });
        };
        
        // ---- 3. Dynamic JSON-LD Injection ----
        const injectSeoData = () => {
            const schemaScript = document.getElementById('video-schema');
            if (!schemaScript) return;
            let schema = JSON.parse(schemaScript.textContent);
            if (timestampDataForSeo.length > 0) schema.hasPart = timestampDataForSeo;
            schemaScript.textContent = JSON.stringify(schema, null, 2);
        };
        
        generateTimestamps();
        injectSeoData();
    });
</script>

{{!-- SEO: Dynamic JSON-LD VideoObject Schema --}}
<script id="video-schema" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": "{{title}}",
  "description": "{{excerpt words="50"}}",
  "uploadDate": "{{date format="YYYY-MM-DDTHH:mm:ss.SSSZ"}}",
  "embedUrl": "https://www.youtube.com/embed/{{custom_excerpt}}",
  "thumbnailUrl": [
    {{#if feature_image}}"{{feature_image}}"{{else}}"https://i.ytimg.com/vi/{{custom_excerpt}}/maxresdefault.jpg"{{/if}}
  ],
  "author": { "@type": "Person", "name": "{{primary_author.name}}" }
}
</script>
{{/post}}