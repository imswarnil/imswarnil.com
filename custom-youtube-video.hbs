{{!< default}}

{{#post}}
<main class="section">
  <div class="container">
    <div class="columns is-variable is-8-desktop">

      {{!-- ======== Main Content Column (Left) ======== --}}
      <div class="column is-9">
        {{!-- We wrap the entire article in a box for a clean, card-like appearance --}}
        <div class="box p-5 p-6-desktop">
          <article class="post-article-main">
            
            <header class="post-header mb-6">
              {{!-- Using a Media Object for a more professional author byline --}}
              <div class="media is-align-items-center mb-4">
                {{#if primary_author.profile_image}}
                  <figure class="media-left">
                    <p class="image is-48x48">
                      <img class="is-rounded" src="{{primary_author.profile_image}}" alt="{{primary_author.name}}">
                    </p>
                  </figure>
                {{/if}}
                <div class="media-content">
                  <p class="is-size-6 has-text-weight-bold">{{primary_author.name}}</p>
                  <p class="is-size-7 has-text-grey">
                    <a href="{{primary_author.url}}" class="has-text-grey">View Profile</a> â€¢ <time datetime="{{date format="YYYY-MM-DD"}}">{{date format="MMMM DD, YYYY"}}</time>
                  </p>
                </div>
              </div>
              <h1 class="title is-size-1-desktop is-size-2-tablet is-size-3-mobile has-text-weight-bold post-title">
                {{title}}
              </h1>
            </header>

            {{!-- The YouTube iframe now has rounded corners for a softer look --}}
            <figure class="image is-16by9" style="border-radius: 8px; overflow: hidden; box-shadow: 0 8px 16px rgba(10,10,10,0.1);">
              <iframe 
                  class="has-ratio"
                  src="https://www.youtube.com/embed/{{custom_excerpt}}?rel=0&color=white" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
              </iframe>
            </figure>

            {{!-- In-Article Ad Placeholder (Styled as a box) --}}
            <div class="box has-background-light has-text-centered my-6">
              <p class="has-text-grey">Advertisement</p>
            </div>

            {{!-- gh-content is a standard class for Ghost content styling --}}
            <div class="content post-content-body is-medium gh-content">
              {{content}}
            </div>
            
          </article>
        </div>
      </div>

      {{!-- ======== Sidebar Column (Right) ======== --}}
      <div class="column is-3">
        <aside class="post-sidebar-sticky">
        
          {{!-- WIDGET 1: Timestamps --}}
          {{!-- This panel is now a beautiful, dynamic container for your timestamps. --}}
          <div id="timestamps-widget" class="panel is-link mb-5" style="display: none;"> {{!-- Initially hidden --}}
            <p class="panel-heading">Timestamps</p>
            <div id="timestamps-target">
              {{!-- The JS will inject clickable panel blocks here --}}
            </div>
          </div>

          {{!-- WIDGET 2: Related Videos (Wrapped in a box for consistency) --}}
          {{#get "posts" filter="tags:hash-video+id:-{{id}}" limit="4" as |related|}}
            {{#if related}}
            <div class="box mb-5">
              <h3 class="title is-5 mb-4">Related Videos</h3>
                {{#foreach related}}
                  <a href="{{url}}" class="is-block mb-4">
                    <figure class="image is-16by9 mb-2">
                      {{#if feature_image}}
                        <img src="{{feature_image}}" alt="{{title}}" loading="lazy" style="border-radius: 6px;">
                      {{else}}
                        <img src="https://i.ytimg.com/vi/{{custom_excerpt}}/hqdefault.jpg" alt="{{title}}" loading="lazy" style="border-radius: 6px;">
                      {{/if}}
                    </figure>
                    <div>
                      <p class="is-size-6 has-text-weight-semibold has-text-dark" style="line-height: 1.3;">{{title}}</p>
                    </div>
                  </a>
                {{/foreach}}
            </div>
            {{/if}}
          {{/get}}

          {{!-- WIDGET 3: Sidebar Advertisement (Styled as a box) --}}
          <div class="box has-background-light has-text-centered">
            <p class="has-text-grey">Advertisement</p>
          </div>

        </aside>
      </div>
    </div>
  </div>
</main>


{{!-- ================== JAVASCRIPT LOGIC ================== --}}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // ---- 1. Make the Sidebar Sticky ----
    const sidebar = document.querySelector('.post-sidebar-sticky');
    if (sidebar && window.innerWidth >= 1024) { // 1024px is Bulma's 'desktop' breakpoint
        sidebar.style.position = 'sticky';
        sidebar.style.top = '2rem'; // Adjust this value based on your navbar height
    }

    // ---- 2. Dynamic Timestamp Generation ----
    const timestampWidget = document.getElementById('timestamps-widget');
    const timestampTarget = document.getElementById('timestamps-target');
    const sourceTable = document.querySelector('.gh-content table'); // Find the first table in the content

    // Proceed only if all three elements exist
    if (!timestampWidget || !timestampTarget || !sourceTable) {
        return;
    }

    const rows = sourceTable.querySelectorAll('tbody tr');
    const fragment = document.createDocumentFragment();

    rows.forEach(row => {
        const cells = row.querySelectorAll('td, th');
        if (cells.length < 2) return;

        // Create a clickable panel-block for each row
        const link = document.createElement('a');
        link.className = 'panel-block is-flex is-justify-content-space-between';
        
        // Create span for timestamp
        const timeSpan = document.createElement('span');
        timeSpan.className = 'has-text-weight-semibold';
        timeSpan.textContent = cells[0].textContent.trim();
        
        // Create span for content
        const contentSpan = document.createElement('span');
        contentSpan.className = 'has-text-right is-size-7';
        contentSpan.textContent = cells[1].textContent.trim();
        
        link.appendChild(timeSpan);
        link.appendChild(contentSpan);
        fragment.appendChild(link);
    });

    // If we successfully created timestamp links, populate the widget
    if (fragment.children.length > 0) {
        timestampTarget.innerHTML = ''; // Clear any placeholder text
        timestampTarget.appendChild(fragment);
        timestampWidget.style.display = 'block'; // Show the widget
        sourceTable.style.display = 'none'; // Hide the original table in the content
    }
});
</script>
{{/post}}