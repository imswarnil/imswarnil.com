{{!< default}}

{{#post}}
<style>
    /* Main layout and color scheme */
    body { background-color: #f9f9f9; }
    .video-main-content .box, .video-sidebar .box { box-shadow: 0 1px 4px rgba(0,0,0,0.04); border: 1px solid #e5e5e5; }

    /* The collapsible description box */
    .description-box-content {
        max-height: 150px; /* Initial collapsed height */
        overflow: hidden;
        position: relative;
        transition: max-height 0.5s ease-in-out;
    }
    .description-box-content::after { /* The "fade out" effect when collapsed */
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, #ffffff);
        pointer-events: none;
    }
    .description-box-content.is-expanded {
        max-height: 2000px; /* A large value to allow full expansion */
    }
    .description-box-content.is-expanded::after {
        display: none; /* Remove the fade when expanded */
    }

    /* Ad placeholder styling */
    .ad-placeholder { background-color: #f0f0f0; border: 2px dashed #dcdcdc; color: #b5b5b5; display: flex; align-items: center; justify-content: center; text-align: center; }
</style>

<main class="section">
  <div class="container">
    {{!-- MONETIZATION: 1. Top Leaderboard Ad --}}
    <div class="ad-placeholder mb-5 is-hidden-mobile" style="min-height: 90px;">
        <p class="is-size-7">AdSense Leaderboard (728x90)</p>
    </div>

    <div class="columns is-variable is-8-desktop">

      {{!-- ======== Main Content Column (Wider) ======== --}}
      <div class="column is-9 video-main-content">
        
        {{!-- The YouTube Video Player --}}
        <figure class="image is-16by9 mb-4">
            <iframe id="youtube-player" class="has-ratio" src="https://www.youtube.com/embed/{{custom_excerpt}}?rel=0&enablejsapi=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </figure>

        {{!-- Tags, Title, and Meta --}}
        <div class="mb-5">
            {{#if tags}}
                <div class="tags">
                    {{#foreach tags limit="3"}}<a class="tag is-info is-light" href="{{url}}">{{name}}</a>{{/foreach}}
                </div>
            {{/if}}
            <h1 class="title is-size-3-desktop is-size-4-mobile has-text-weight-bold post-title mb-3">{{title}}</h1>
            <div class="level is-mobile">
                <div class="level-left">
                    <p class="is-size-7 has-text-grey">{{!-- Example: 1.2M views â€¢ --}} <time datetime="{{date format="YYYY-MM-DD"}}">{{date format="MMMM DD, YYYY"}}</time></p>
                </div>
                <div class="level-right">
                    <div class="share-buttons buttons has-addons">
                        <a class="button is-small" data-social="twitter"><span class="icon"><i class="fab fa-twitter"></i></span><span>Share</span></a>
                        <a class="button is-small" data-social="facebook"><span class="icon"><i class="fab fa-facebook-f"></i></span></a>
                        <a class="button is-small" data-social="whatsapp"><span class="icon"><i class="fab fa-whatsapp"></i></span></a>
                    </div>
                </div>
            </div>
        </div>

        <hr class="my-5">

        {{!-- YouTube Channel Subscribe Widget --}}
        <div class="level is-mobile mb-5">
            <div class="level-left">
                <div class="media is-align-items-center">
                    <figure class="media-left">
                        <p class="image is-48x48">
                            <img class="is-rounded" src="{{primary_author.profile_image}}" alt="{{primary_author.name}}">
                        </p>
                    </figure>
                    <div class="media-content">
                        <p class="title is-6">{{primary_author.name}}</p>
                        <p class="subtitle is-7 has-text-grey">{{!-- Use post excerpt for subscriber count --}} {{excerpt}} subscribers</p>
                    </div>
                </div>
            </div>
            <div class="level-right">
                <a href="#" class="button is-danger is-rounded has-text-weight-bold">
                    <span class="icon"><i class="fab fa-youtube"></i></span>
                    <span>Subscribe</span>
                </a>
            </div>
        </div>
        
        {{!-- MONETIZATION: 2. Below Player Ad --}}
        <div class="ad-placeholder my-6" style="min-height: 100px;">
            <p class="is-size-7">AdSense Responsive Ad Unit</p>
        </div>

        {{!-- Description Box with Timestamps --}}
        <div class="box p-5">
            <div class="description-box-content" id="description-wrapper">
                {{!-- The post content, including your timestamp table, goes here --}}
                <div class="content is-medium gh-content">
                    {{content}}
                </div>
            </div>
            <button class="button is-small is-fullwidth mt-4" id="show-more-btn">Show More</button>
        </div>

        {{!-- MONETIZATION: 3. In-Article Ad --}}
        <div class="ad-placeholder my-6" style="min-height: 250px;">
            <p class="is-size-7">AdSense In-article Ad Unit</p>
        </div>

        {{!-- Author Bio Box --}}
        {{#primary_author}}
        <div class="box">
            <p class="title is-5 mb-4">About the Author</p>
            <article class="media">
                <div class="media-content">
                    <div class="content"><p>{{bio}}</p></div>
                </div>
            </article>
        </div>
        {{/primary_author}}

        {{!-- MONETIZATION: 4. Second In-Article Ad --}}
        <div class="ad-placeholder my-6" style="min-height: 250px;">
            <p class="is-size-7">AdSense Matched Content or In-article Ad</p>
        </div>
        
        {{!-- Ghost Portal Comments --}}
        <div class="mt-6">{{comments}}</div>
      </div>

      {{!-- ======== Sidebar Column ======== --}}
      <div class="column is-3 video-sidebar">
        <aside class="post-sidebar-sticky">
        
          {{!-- MONETIZATION: 5. Sidebar Top Ad --}}
          <div class="ad-placeholder box mb-5" style="min-height: 280px;">
            <p class="is-size-7">AdSense Display Ad (300x250)</p>
          </div>

          {{!-- Related Videos Widget --}}
          {{#get "posts" filter="tags:hash-video+id:-{{id}}" limit="4" as |related|}}
            {{#if related}}
            <div class="box mb-5">
              <h3 class="title is-6 mb-4">Related Videos</h3>
                {{#foreach related}}
                  <a href="{{url}}" class="media mb-4">
                      <figure class="media-left"><p class="image is-128x72"><img src="{{#if feature_image}}{{feature_image}}{{else}}https://i.ytimg.com/vi/{{custom_excerpt}}/hqdefault.jpg{{/if}}" alt="{{title}}" loading="lazy"></p></figure>
                      <div class="media-content"><p class="is-size-7 has-text-weight-bold has-text-dark" style="line-height: 1.4;">{{title}}</p></div>
                  </a>
                {{/foreach}}
            </div>
            {{/if}}
          {{/get}}

          {{!-- MONETIZATION: 6. Native Ad Placeholder --}}
          <div class="box mb-5">
            <h3 class="title is-6 mb-4 has-text-grey-light">Sponsored</h3>
            <a href="#" class="media mb-4">
              <figure class="media-left"><p class="image is-128x72"><img class="ad-placeholder" alt="Native Ad"></p></figure>
              <div class="media-content"><p class="is-size-7 has-text-weight-bold has-text-dark" style="line-height: 1.4;">This is a Native Ad That Looks Like a Related Post</p></div>
            </a>
          </div>

          {{!-- Latest Posts Widget --}}
          {{#get "posts" limit="3" filter="id:-{{id}}" as |latest|}}
            {{#if latest}}
            <div class="box mb-5">
              <h3 class="title is-6 mb-4">Latest Posts</h3>
                {{#foreach latest}}
                  <a href="{{url}}" class="media mb-4">
                      <div class="media-content"><p class="is-size-7 has-text-weight-bold has-text-dark" style="line-height: 1.4;">{{title}}</p></div>
                  </a>
                {{/foreach}}
            </div>
            {{/if}}
          {{/get}}

          {{!-- Categories Widget --}}
          {{#get "tags" limit="10" include="count.posts" order="count.posts desc"}}
            {{#if tags}}
            <div class="box mb-5">
                <h3 class="title is-6 mb-4">Popular Categories</h3>
                <div class="tags are-medium">
                    {{#foreach tags}}<a href="{{url}}" class="tag">{{name}}</a>{{/foreach}}
                </div>
            </div>
            {{/if}}
          {{/get}}

          {{!-- MONETIZATION: 7. Sidebar Bottom Ad --}}
          <div class="ad-placeholder box" style="min-height: 600px;">
            <p class="is-size-7">AdSense Skyscraper Ad (300x600)</p>
          </div>
        </aside>
      </div>
    </div>
  </div>
</main>


{{!-- ================== JAVASCRIPT & SEO ================== --}}
<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    
    function onYouTubeIframeAPIReady() {
        if (document.getElementById('youtube-player')) {
            player = new YT.Player('youtube-player', { events: { 'onReady': onPlayerReady } });
        }
    }

    function onPlayerReady(event) {
        // Attach click listeners only when the player is ready
        document.querySelectorAll('a.timestamp-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const time = parseFloat(link.dataset.time);
                if (player && typeof player.seekTo === 'function') {
                    player.seekTo(time, true);
                    player.playVideo();
                }
            });
        });
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        // ---- 1. Sticky Sidebar ----
        const sidebar = document.querySelector('.post-sidebar-sticky');
        if (sidebar && window.innerWidth >= 1024) {
            sidebar.style.position = 'sticky';
            sidebar.style.top = '2rem';
        }

        // ---- 2. Description Box Toggle and Timestamp Parsing ----
        const descriptionWrapper = document.getElementById('description-wrapper');
        const showMoreBtn = document.getElementById('show-more-btn');
        const sourceTable = descriptionWrapper.querySelector('.gh-content table');

        if (sourceTable) {
            const rows = sourceTable.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td, th');
                if (cells.length < 2) return;
                const timeCell = cells[0];
                const timeStr = timeCell.textContent.trim().split(' ')[0];
                const parts = timeStr.split(':').map(part => parseInt(part, 10));
                let seconds = 0;
                if (parts.length === 3) seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
                else if (parts.length === 2) seconds = parts[0] * 60 + parts[1];
                
                // Make the timestamp cell a clickable link
                timeCell.innerHTML = `<a href="#t=${seconds}" class="timestamp-link" data-time="${seconds}">${timeCell.innerHTML}</a>`;
            });
        }
        
        if (showMoreBtn && descriptionWrapper) {
            // Hide button if content isn't overflowing
            if (descriptionWrapper.scrollHeight <= 150) {
                showMoreBtn.style.display = 'none';
            } else {
                showMoreBtn.addEventListener('click', () => {
                    descriptionWrapper.classList.toggle('is-expanded');
                    if (descriptionWrapper.classList.contains('is-expanded')) {
                        showMoreBtn.textContent = 'Show Less';
                    } else {
                        showMoreBtn.textContent = 'Show More';
                    }
                });
            }
        }
        
        // ---- 3. Share Buttons ----
        const setupShareButtons = () => {
            document.querySelectorAll('.share-buttons a').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    let url = encodeURIComponent(window.location.href);
                    let title = encodeURIComponent(document.title);
                    let shareUrl = '';
                    const social = button.dataset.social;
                    if(social === 'twitter') shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                    if(social === 'facebook') shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                    if(social === 'whatsapp') shareUrl = `https://api.whatsapp.com/send?text=${title}%20${url}`;
                    if(shareUrl) window.open(shareUrl, 'share-window', 'height=450,width=550');
                });
            });
        };
        setupShareButtons();
    });
</script>

{{!-- SEO: Dynamic JSON-LD VideoObject Schema --}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": "{{title}}",
  "description": "{{excerpt words="50"}}",
  "uploadDate": "{{date format="YYYY-MM-DDTHH:mm:ss.SSSZ"}}",
  "embedUrl": "https://www.youtube.com/embed/{{custom_excerpt}}",
  "thumbnailUrl": [
    {{#if feature_image}}"{{feature_image}}"{{else}}"https://i.ytimg.com/vi/{{custom_excerpt}}/maxresdefault.jpg"{{/if}}
  ],
  "author": { "@type": "Person", "name": "{{primary_author.name}}" }
}
</script>
{{/post}}